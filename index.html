<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
      <meta name="x5-orientation" content="landscape" />
      <meta name="screen-orientation" content="landscape" />

    <meta name="x5-fullscreen" content="true" />
    <meta name="full-screen" content="true" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="width" />
    <title>诗行山河 - 跟着诗句游中国</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/map.css" />
    <link rel="stylesheet" href="css/detail.css" />
    <link rel="stylesheet" href="css/pop.css" />
    <link rel="stylesheet" href="css/bgm-control.css" />
  </head>
  <body>
    <!-- 全局水墨风图标和BGM控制 -->
    <div class="global-icon" id="bgmControl">
      <img src="images/icon/演出.png" class="BGMon" style="display:none;"></img>
      <img src="images/icon/演出关闭.png" class="BGMoff" style="display:block;"></img>
      <audio src="audio/effects/bgm.mp3" loop id="bgm"></audio>
    </div>
    

    <!-- BGM控制脚本 -->
    <script src="js/bgm-control.js"></script>
    
    <!-- 响应式横屏设计脚本 -->
    <script>
      // 实现电脑端全屏，手机端横屏显示的响应式设计
      function setupResponsiveLandscape() {
        // 基础样式设置
        const container = document.documentElement;
        const body = document.body;
        
        container.style.width = '100%';
        container.style.height = '100%';
        body.style.width = '100%';
        body.style.height = '100%';
        body.style.margin = '0';
        body.style.padding = '0';
        body.style.overflow = 'hidden';
        
        // 检查是否已有landscape-container
        let landscapeContainer = document.getElementById('landscape-container');
        
        // 如果容器不存在，创建并移动内容
        if (!landscapeContainer) {
          // 创建主容器
          landscapeContainer = document.createElement('div');
          landscapeContainer.id = 'landscape-container';
          
          // 保存需要移动的元素（跳过当前脚本和已添加的style标签）
          const elementsToMove = [];
          const scriptTags = document.querySelectorAll('script');
          const styleTags = document.querySelectorAll('style');
          
          for (let i = 0; i < body.children.length; i++) {
            const child = body.children[i];
            // 跳过当前脚本和已经存在的style标签
            if ((scriptTags && !Array.from(scriptTags).includes(child)) && 
                (styleTags && !Array.from(styleTags).includes(child))) {
              elementsToMove.push(child);
            }
          }
          
          // 将元素移到容器中
          elementsToMove.forEach(el => landscapeContainer.appendChild(el));
          
          // 添加容器到body
          body.appendChild(landscapeContainer);
        }
        
        // 适配函数
        function adaptToScreen() {
          const width = window.innerWidth || document.documentElement.clientWidth;
          const height = window.innerHeight || document.documentElement.clientHeight;
          
          // 判断是否需要横屏显示
          if (width < height) {
            // 竖屏设备，强制横屏显示
            const scale = height / width;
            landscapeContainer.style.transform = 'rotate(90deg) scale(' + scale + ')';
            landscapeContainer.style.transformOrigin = 'center center';
            landscapeContainer.style.position = 'fixed';
            landscapeContainer.style.top = '50%';
            landscapeContainer.style.left = '50%';
            landscapeContainer.style.width = height + 'px';
            landscapeContainer.style.height = width + 'px';
            landscapeContainer.style.marginTop = -width / 2 + 'px';
            landscapeContainer.style.marginLeft = -height / 2 + 'px';
          } else {
            // 横屏设备，正常显示
            landscapeContainer.style.transform = 'none';
            landscapeContainer.style.position = 'fixed';
            landscapeContainer.style.top = '0';
            landscapeContainer.style.left = '0';
            landscapeContainer.style.width = '100%';
            landscapeContainer.style.height = '100%';
            landscapeContainer.style.margin = '0';
          }
        }
        
        // 监听事件
        window.addEventListener('resize', adaptToScreen);
        window.addEventListener('orientationchange', adaptToScreen);
        
        // 初始化
        adaptToScreen();
        
        // 尝试锁定屏幕方向
        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(() => {
            // 锁定失败时，继续使用CSS转换
          });
        } else if (screen.lockOrientation) {
          screen.lockOrientation('landscape').catch(() => {
            // 锁定失败时，继续使用CSS转换
          });
        }
      }
      
      // 页面加载完成后执行
      window.addEventListener('load', setupResponsiveLandscape);
    </script>
    
    <style>
      /* 基础样式设置 - 电脑端全屏，手机端横屏显示 */
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        position: fixed;
      }
      
      /* 防止双击缩放 */
      * {
        touch-action: manipulation;
      }
      
      /* 页面容器样式 */
      .page {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        position: relative;
        overflow: hidden;
        display: none;
      }
      
      .page.active {
        display: block;
      }
      
      /* 横屏容器样式 */
      #landscape-container {
        transition: transform 0.3s ease;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
    </style>
    
    <!-- 毛笔鼠标跟随元素 -->
    <div id="brush-cursor" style="position: fixed; pointer-events: none; z-index: 9999;">
      <img src="images/picture/image/毛笔.png" alt="毛笔" style="width: 0.5rem; height: 0.5rem; object-fit: contain;">
    </div>
    
    <!-- 加载页面 -->
    <div id="loading-page" class="page active">
      <div class="logo">诗行山河</div>
      <div class="subtitle">跟着诗句游中国 · 穿越千年的文化之旅</div>
      <div class="loading-bar">
        <div class="loading-progress" id="loading-progress"></div>
      </div>
    </div>
    
    <!-- 模板 -->
    <template id="poemTemplate">
      <div class="poem-line"></div>
    </template>
    
    <!-- 首页面 -->
    <div id="map-page" class="page">
      <div class="title-bar">
        <h1>诗行山河</h1>
        <img src="images/picture/image/诗词印章.png" alt="">
      </div>
      <div class="map-juanzhou">
        <img src="images/picture/image/卷轴.webp" alt="">
      </div>
      <div class="open">
        <p>点击打开卷轴</p>
      </div>
    </div>

    <!-- 诗句选择页面 -->
    <div id="poem-page" class="page"> 
      <div class="bg">
        <img src="images/picture/image/卷轴开.png" alt="">
      </div>
      <div class="shiju" id="shijuContainer"></div>
      <div class="back">
        <img src="images/picture/image/文字点击底图.png" alt="">
        <p>点击关闭卷轴</p>
      </div>
    </div>

    <!-- 古今对比页 -->
     <div id="detail-page" class="page">
      <div class="poemDetail">
        <div class="back-button" id="backToPoem">
          <img src="images/picture/image/文字点击底图.png" alt="返回">
          <p>返回</p>
        </div>
        <div class="switch">
          <img src="images/icon/古今.png" alt="古今">
          <p class="gujin"></p>
        </div>
        <div class="pgUp">
          <img src="images/icon/左.png" alt="">
        </div>
        <div class="pgDown">
          <img src="images/icon/右.png" alt="">
        </div>
        <!-- 背景图片容器 -->
        <div class="image-container">
          <img src="" alt="古代图" class="ancient-img">
          <img src="" alt="现代图" class="modern-img">
        </div>
        <div class="leftTop">
          <div class="title">
            <!-- 标题文本将通过JavaScript动态插入 -->
            <div class="poemMusic">
              <img src="images/icon/诗词静音.png" class="poemOff">
              <img src="images/icon/诗词声音.png" class="poemOn">
              <audio src="" id="poemAudio"> </audio>
            </div>
          </div>
          <div class="subTitle"></div>
          <div class="fullPoem"></div>
        </div>
        <div class="leftBottom">
          <img src="" alt="诗人" class="poet">
        </div>
        <div class="rightBottom">
          <div class="place-bar">
            <img src="images/icon/坐标.png" alt="" class="building">
            <span class="placeName"></span>
          </div>
          <div class="position"></div>
          <hr>
          <div class="story"></div>
        </div>
      </div>
     </div>

     <!-- 景区弹窗 -->
    <div class="pop">
      <div class="close">
        <img src="images/icon/取消.png" alt="" class="closepop">
      </div>
      <!-- 内容 -->
      <div class="place-content">
        <span class="placeName"></span>
        <hr>
        <div class="gushi"></div>
      </div>
      <!-- 照片 -->
      <div class="place-picture">
        <!-- <p>我去</p> -->
        <img src="" alt="" class="p1"></img>
        <img src="" alt="" class="p2"></img>
        <img src="" alt="" class="p3"></img>
        <img src="" alt="" class="p4"></img>
      </div>
    </div>







    <!-- 数据文件 - 直接嵌入JavaScript以避免CORS问题 -->
    <script src="data/places.js"></script>
    
    <!-- <script src="js/utils.js"></script> -->
    <script src="js/poem.js"></script>
    <script src="js/map.js"></script>
    <script src="js/main.js"></script>
    <script src="js/poem-music.js"></script>
  </body>
</html>
