<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi" />
    <meta name="x5-orientation" content="landscape" />
    <meta name="screen-orientation" content="landscape" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="full-screen" content="true" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="1000" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>è¯—è¡Œå±±æ²³ - è·Ÿç€è¯—å¥æ¸¸ä¸­å›½</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/map.css" />
    <link rel="stylesheet" href="css/detail.css" />
    <link rel="stylesheet" href="css/pop.css" />
    <link rel="stylesheet" href="css/bgm-control.css" />
  </head>
  <body>
    <!-- å…¨å±€æ°´å¢¨é£å›¾æ ‡å’ŒBGMæ§åˆ¶ -->
    <div class="global-icon" id="bgmControl">
      <img src="images/icon/æ¼”å‡º.png" class="BGMon" style="display:none;"></img>
      <img src="images/icon/æ¼”å‡ºå…³é—­.png" class="BGMoff" style="display:block;"></img>
      <audio src="audio/effects/bgm.mp3" loop id="bgm"></audio>
    </div>
    

    <!-- BGMæ§åˆ¶è„šæœ¬ -->
    <script src="js/bgm-control.js"></script>
    
    <!-- å“åº”å¼æ¨ªå±è®¾è®¡è„šæœ¬ -->
    <script>
      // å®ç°ç”µè„‘ç«¯å…¨å±ï¼Œæ‰‹æœºç«¯æ¨ªå±æ˜¾ç¤ºçš„å“åº”å¼è®¾è®¡
      function setupResponsiveLandscape() {
        // åŸºç¡€æ ·å¼è®¾ç½®
        const container = document.documentElement;
        const body = document.body;
        
        container.style.width = '100%';
        container.style.height = '100%';
        body.style.width = '100%';
        body.style.height = '100%';
        body.style.margin = '0';
        body.style.padding = '0';
        body.style.overflow = 'hidden';
        
        // æ£€æŸ¥æ˜¯å¦å·²æœ‰landscape-container
        let landscapeContainer = document.getElementById('landscape-container');
        
        // å¦‚æœå®¹å™¨ä¸å­˜åœ¨ï¼Œåˆ›å»ºå¹¶ç§»åŠ¨å†…å®¹
        if (!landscapeContainer) {
          // åˆ›å»ºä¸»å®¹å™¨
          landscapeContainer = document.createElement('div');
          landscapeContainer.id = 'landscape-container';
          
          // ä¿å­˜éœ€è¦ç§»åŠ¨çš„å…ƒç´ ï¼ˆè·³è¿‡å½“å‰è„šæœ¬å’Œå·²æ·»åŠ çš„styleæ ‡ç­¾ï¼‰
          const elementsToMove = [];
          const scriptTags = document.querySelectorAll('script');
          const styleTags = document.querySelectorAll('style');
          
          for (let i = 0; i < body.children.length; i++) {
            const child = body.children[i];
            // è·³è¿‡å½“å‰è„šæœ¬å’Œå·²ç»å­˜åœ¨çš„styleæ ‡ç­¾
            if ((scriptTags && !Array.from(scriptTags).includes(child)) && 
                (styleTags && !Array.from(styleTags).includes(child))) {
              elementsToMove.push(child);
            }
          }
          
          // å°†å…ƒç´ ç§»åˆ°å®¹å™¨ä¸­
          elementsToMove.forEach(el => landscapeContainer.appendChild(el));
          
          // æ·»åŠ å®¹å™¨åˆ°body
          body.appendChild(landscapeContainer);
        }
        
        // é€‚é…å‡½æ•°
        function adaptToScreen() {
          const width = window.innerWidth || document.documentElement.clientWidth;
          const height = window.innerHeight || document.documentElement.clientHeight;
          
          // åˆ¤æ–­æ˜¯å¦éœ€è¦æ¨ªå±æ˜¾ç¤º
          if (width < height) {
            // ç«–å±è®¾å¤‡ï¼Œå¼ºåˆ¶æ¨ªå±æ˜¾ç¤º
            const scale = height / width;
            landscapeContainer.style.transform = 'rotate(90deg) scale(' + scale + ')';
            landscapeContainer.style.transformOrigin = 'center center';
            landscapeContainer.style.position = 'fixed';
            landscapeContainer.style.top = '50%';
            landscapeContainer.style.left = '50%';
            landscapeContainer.style.width = height + 'px';
            landscapeContainer.style.height = width + 'px';
            landscapeContainer.style.marginTop = -width / 2 + 'px';
            landscapeContainer.style.marginLeft = -height / 2 + 'px';
          } else {
            // æ¨ªå±è®¾å¤‡ï¼Œæ­£å¸¸æ˜¾ç¤º
            landscapeContainer.style.transform = 'none';
            landscapeContainer.style.position = 'fixed';
            landscapeContainer.style.top = '0';
            landscapeContainer.style.left = '0';
            landscapeContainer.style.width = '100%';
            landscapeContainer.style.height = '100%';
            landscapeContainer.style.margin = '0';
          }
        }
        
        // ç›‘å¬äº‹ä»¶
        window.addEventListener('resize', adaptToScreen);
        window.addEventListener('orientationchange', adaptToScreen);
        
        // åˆå§‹åŒ–
        adaptToScreen();
        
        // å°è¯•é”å®šå±å¹•æ–¹å‘ - å…¼å®¹æ›´å¤šæµè§ˆå™¨
        function lockOrientation() {
          // æ˜¾ç¤ºæç¤ºä¿¡æ¯
          const showOrientationTip = () => {
            // åˆ›å»ºæç¤ºå…ƒç´ 
            let tip = document.getElementById('orientation-tip');
            if (!tip && width < height) {
              tip = document.createElement('div');
              tip.id = 'orientation-tip';
              tip.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.9);
                color: white;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                font-size: 1.5rem;
                text-align: center;
                padding: 2rem;
              `;
              tip.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 2rem;">ğŸ“±</div>
                <p>è¯·å°†æ‰‹æœºæ¨ªå±ä»¥è·å¾—æœ€ä½³ä½“éªŒ</p>
              `;
              document.body.appendChild(tip);
            } else if (tip && width >= height) {
              tip.remove();
            }
          };
          
          // å°è¯•å¤šç§é”å®šæ–¹æ³•
          if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape').catch(() => {
              showOrientationTip();
            });
          } else if (screen.lockOrientation) {
            screen.lockOrientation('landscape').catch(() => {
              showOrientationTip();
            });
          } else if (screen.mozLockOrientation) {
            screen.mozLockOrientation('landscape').catch(() => {
              showOrientationTip();
            });
          } else if (screen.webkitLockOrientation) {
            screen.webkitLockOrientation('landscape').catch(() => {
              showOrientationTip();
            });
          } else {
            // æ‰€æœ‰é”å®šæ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤º
            showOrientationTip();
          }
        }
        
        // è°ƒç”¨é”å®šæ–¹å‘å‡½æ•°
        lockOrientation();
      }
      
      // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
      window.addEventListener('load', setupResponsiveLandscape);
    </script>
    
    <style>
      /* åŸºç¡€æ ·å¼è®¾ç½® - ç”µè„‘ç«¯å…¨å±ï¼Œæ‰‹æœºç«¯æ¨ªå±æ˜¾ç¤º */
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        position: fixed;
      }
      
      /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
      * {
        touch-action: manipulation;
      }
      
      /* é¡µé¢å®¹å™¨æ ·å¼ */
      .page {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        position: relative;
        overflow: hidden;
        display: none;
      }
      
      .page.active {
        display: block;
      }
      
      /* æ¨ªå±å®¹å™¨æ ·å¼ */
      #landscape-container {
        transition: transform 0.3s ease;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
    </style>
    
    <!-- æ¯›ç¬”é¼ æ ‡è·Ÿéšå…ƒç´  -->
    <div id="brush-cursor" style="position: fixed; pointer-events: none; z-index: 9999;">
      <img src="images/picture/image/æ¯›ç¬”.png" alt="æ¯›ç¬”" style="width: 5rem; height: 4rem; object-fit: contain;">
    </div>
    
    <!-- åŠ è½½é¡µé¢ -->
    <div id="loading-page" class="page active">
      <div class="logo">è¯—è¡Œå±±æ²³</div>
      <div class="subtitle">è·Ÿç€è¯—å¥æ¸¸ä¸­å›½ Â· ç©¿è¶Šåƒå¹´çš„æ–‡åŒ–ä¹‹æ—…</div>
      <div class="loading-bar">
        <div class="loading-progress" id="loading-progress"></div>
      </div>
    </div>
    
    <!-- æ¨¡æ¿ -->
    <template id="poemTemplate">
      <div class="poem-line"></div>
    </template>
    
    <!-- é¦–é¡µé¢ -->
    <div id="map-page" class="page">
      <div class="title-bar">
        <h1>è¯—è¡Œå±±æ²³</h1>
        <img src="images/picture/image/è¯—è¯å°ç« .png" alt="">
      </div>
      <div class="map-juanzhou">
        <img src="images/picture/image/å·è½´.webp" alt="">
      </div>
      <div class="open">
        <p>ç‚¹å‡»æ‰“å¼€å·è½´</p>
      </div>
    </div>

    <!-- è¯—å¥é€‰æ‹©é¡µé¢ -->
    <div id="poem-page" class="page"> 
      <div class="bg">
        <img src="images/picture/image/å·è½´å¼€.png" alt="">
      </div>
      <div class="shiju" id="shijuContainer"></div>
      <div class="back">
        <img src="images/picture/image/æ–‡å­—ç‚¹å‡»åº•å›¾.png" alt="">
        <p>ç‚¹å‡»å…³é—­å·è½´</p>
      </div>
    </div>

    <!-- å¤ä»Šå¯¹æ¯”é¡µ -->
     <div id="detail-page" class="page">
      <div class="poemDetail">
        <div class="back-button" id="backToPoem">
          <img src="images/picture/image/æ–‡å­—ç‚¹å‡»åº•å›¾.png" alt="è¿”å›">
          <p>è¿”å›</p>
        </div>
        <div class="switch">
          <img src="images/icon/å¤ä»Š.png" alt="å¤ä»Š">
          <p class="gujin"></p>
        </div>
        <div class="pgUp">
          <img src="images/icon/å·¦.png" alt="">
        </div>
        <div class="pgDown">
          <img src="images/icon/å³.png" alt="">
        </div>
        <!-- èƒŒæ™¯å›¾ç‰‡å®¹å™¨ -->
        <div class="image-container">
          <img src="" alt="å¤ä»£å›¾" class="ancient-img">
          <img src="" alt="ç°ä»£å›¾" class="modern-img">
        </div>
        <div class="leftTop">
          <div class="title">
            <!-- æ ‡é¢˜æ–‡æœ¬å°†é€šè¿‡JavaScriptåŠ¨æ€æ’å…¥ -->
            <div class="poemMusic">
              <img src="images/icon/è¯—è¯é™éŸ³.png" class="poemOff">
              <img src="images/icon/è¯—è¯å£°éŸ³.png" class="poemOn">
              <audio src="" id="poemAudio"> </audio>
            </div>
          </div>
          <div class="subTitle"></div>
          <div class="fullPoem"></div>
        </div>
        <div class="leftBottom">
          <img src="" alt="è¯—äºº" class="poet">
        </div>
        <div class="rightBottom">
          <div class="place-bar">
            <img src="images/icon/åæ ‡.png" alt="" class="building">
            <span class="placeName"></span>
          </div>
          <div class="position"></div>
          <hr>
          <div class="story"></div>
        </div>
      </div>
     </div>

     <!-- æ™¯åŒºå¼¹çª— -->
    <div class="pop">
      <div class="close">
        <img src="images/icon/å–æ¶ˆ.png" alt="" class="closepop">
      </div>
      <!-- å†…å®¹ -->
      <div class="place-content">
        <span class="placeName"></span>
        <hr>
        <div class="gushi"></div>
      </div>
      <!-- ç…§ç‰‡ -->
      <div class="place-picture">
        <!-- <p>æˆ‘å»</p> -->
        <img src="" alt="" class="p1"></img>
        <img src="" alt="" class="p2"></img>
        <img src="" alt="" class="p3"></img>
        <img src="" alt="" class="p4"></img>
      </div>
    </div>







    <!-- æ•°æ®æ–‡ä»¶ - ç›´æ¥åµŒå…¥JavaScriptä»¥é¿å…CORSé—®é¢˜ -->
    <script src="data/places.js"></script>
    
    <!-- <script src="js/utils.js"></script> -->
    <script src="js/poem.js"></script>
    <script src="js/map.js"></script>
    <script src="js/main.js"></script>
    <script src="js/poem-music.js"></script>
  </body>
</html>
